<%= render "shared/header" %>

<div class="body-wrap">
  <div class="nutrition-head">
    <div class="to-root">
      <%= link_to "記録一覧へ戻る", records_path, class:"root-btn to-record" %>
    </div> 
  </div>

  <div class="table-wrap">
    <table class="table">
      <tr>
        <th class="head-column">お客様名</th>
        <th class="head-column">水分合計</th>
        <th class="head-column">6時水分量</th>
        <th class="head-column">朝食事量</th>
        <th class="head-column">朝水分量</th>
        <th class="head-column">10時水分量</th>
        <th class="head-column">昼食事量</th>
        <th class="head-column">昼水分量</th>
        <th class="head-column">15時水分量</th>
        <th class="head-column">夕食事量</th>
        <th class="head-column">夕水分量</th>
        <th class="head-column">20時水分量</th>
        <th class="head-column">記録／更新</th>
      </tr>
        <% @clients.each do |client| %>
          <tr>
            <%= form_with model: @nutrition, url: nutritions_path, method: :post, class: 'record-main', local: true do |f| %>
              <%# <%= render 'shared/error_messages', model: f.object %>
              <td class="client-one-column">
                <div class="nutrition-box">
                  <% if client.picture.file.nil? %> 
                    <%= image_tag '/assets/human.png', size: "30x30",class:"nutrition-img-box" %>
                  <% else %>
                    <%= image_tag (client.picture.url), size: "30x30", class:"nutrition-img-box" %>
                  <% end %>
                </div>
                <%= link_to "#{client.name} 様", client_path(client.id), method: :get, class: "record-client-name" %>
                <div class="record-room-number"><%= client.room_number %></div>
              </td>
              <td class="one-column">
                <% if client.nutritions.find_by(date: Date.today).nil? %>
                 <p>未入力</p>
                <% else %>
                  <%= client.nutritions.find_by(date: Date.today).six_water_amount + 
                  client.nutritions.find_by(date: Date.today).morning_water_amount +
                  client.nutritions.find_by(date: Date.today).ten_water_amount +
                  client.nutritions.find_by(date: Date.today).lunch_water_amount +
                  client.nutritions.find_by(date: Date.today).fifty_water_amount +
                  client.nutritions.find_by(date: Date.today).dinner_water_amount +
                  client.nutritions.find_by(date: Date.today).twenty_water_amount %>
                <% end %>
              </td>
              <td class="one-column">
                <% if client.nutritions.find_by(date: Date.today).nil? %>
                  <%= f.number_field :six_water_amount, value: 0, class:"water-default", id:"six-water" %> 
                <% else %>
                  <%= f.number_field :six_water_amount, value: client.nutritions.find_by(date: Date.today).six_water_amount, class:"water-default", id:"six-water" %> 
                <% end %>
              </td>
              <td class="one-column">
                <% if client.nutritions.find_by(date: Date.today).nil? %>
                  <%= f.collection_select(:morning_meal_m_id, Meal.all, :id, :name, {selected: 1}, {class:"input-default", id:"morning-main"}) %>
                  <%= f.collection_select(:morning_meal_s_id, Meal.all, :id, :name, {selected: 1}, {class:"input-default", id:"morning-sub"}) %>
                <% else %>
                  <%= f.collection_select(:morning_meal_m_id, Meal.all, :id, :name, {selected: client.nutritions.find_by(date: Date.today).morning_meal_m_id}, {class:"input-default", id:"morning-main"}) %>
                  <%= f.collection_select(:morning_meal_s_id, Meal.all, :id, :name, {selected: client.nutritions.find_by(date: Date.today).morning_meal_s_id}, {class:"input-default", id:"morning-sub"}) %>
                <% end %>
              </td>
              <td class="one-column">
                <% if client.nutritions.find_by(date: Date.today).nil? %>
                  <%= f.number_field :morning_water_amount, value: 0,  class:"water-default", id:"morning-water" %> 
                <% else %>
                  <%= f.number_field :morning_water_amount, value: client.nutritions.find_by(date: Date.today).morning_water_amount, class:"water-default", id:"morning-water" %> 
                <% end %>              
              </td>
              <td class="one-column">
                <% if client.nutritions.find_by(date: Date.today).nil? %>
                  <%= f.number_field :ten_water_amount, value: 0, class:"water-default", id:"ten-water" %> 
                <% else %>
                  <%= f.number_field :ten_water_amount, value: client.nutritions.find_by(date: Date.today).ten_water_amount, class:"water-default", id:"ten-water" %> 
                <% end %>    
              </td>
              <td class="one-column">
                <% if client.nutritions.find_by(date: Date.today).nil? %>
                  <%= f.collection_select(:lunch_meal_m_id, Meal.all, :id, :name, {selected: 1}, {class:"input-default", id:"lunch-main"}) %>
                  <%= f.collection_select(:lunch_meal_s_id, Meal.all, :id, :name, {selected: 1}, {class:"input-default", id:"lunch-sub"}) %>
                <% else %>
                  <%= f.collection_select(:lunch_meal_m_id, Meal.all, :id, :name, {selected: client.nutritions.find_by(date: Date.today).lunch_meal_m_id}, {class:"input-default", id:"lunch-main"}) %>
                  <%= f.collection_select(:lunch_meal_s_id, Meal.all, :id, :name, {selected: client.nutritions.find_by(date: Date.today).lunch_meal_s_id}, {class:"input-default", id:"lunch-sub"}) %>
                <% end %>
              </td>
              <td class="one-column">
                <% if client.nutritions.find_by(date: Date.today).nil? %>
                  <%= f.number_field :lunch_water_amount, value: 0, class:"water-default", id:"lunch-water" %> 
                <% else %>
                  <%= f.number_field :lunch_water_amount, value: client.nutritions.find_by(date: Date.today).lunch_water_amount, class:"water-default", id:"lunch-water" %> 
                <% end %>
              </td>
              <td class="one-column">
                <% if client.nutritions.find_by(date: Date.today).nil? %>
                  <%= f.number_field :fifty_water_amount, value: 0, class:"water-default", id:"fifty-water" %> 
                <% else %>
                  <%= f.number_field :fifty_water_amount, value: client.nutritions.find_by(date: Date.today).fifty_water_amount, class:"water-default", id:"fifty-water" %> 
                <% end %>
              </td>
              <td class="one-column">
                <% if client.nutritions.find_by(date: Date.today).nil? %>
                  <%= f.collection_select(:dinner_meal_m_id, Meal.all, :id, :name, {selected: 1}, {class:"input-default", id:"dinner-main"}) %>
                  <%= f.collection_select(:dinner_meal_s_id, Meal.all, :id, :name, {selected: 1}, {class:"input-default", id:"dinner-sub"}) %>
                <% else %>
                  <%= f.collection_select(:dinner_meal_m_id, Meal.all, :id, :name, {selected: client.nutritions.find_by(date: Date.today).dinner_meal_m_id}, {class:"input-default", id:"dinner-main"}) %>
                  <%= f.collection_select(:dinner_meal_s_id, Meal.all, :id, :name, {selected: client.nutritions.find_by(date: Date.today).dinner_meal_s_id}, {class:"input-default", id:"dinner-sub"}) %>
                <% end %>  
              </td>
              <td class="one-column">
                <% if client.nutritions.find_by(date: Date.today).nil? %>
                  <%= f.number_field :dinner_water_amount, value: 0, class:"water-default", id:"dinner-water" %> 
                <% else %>
                  <%= f.number_field :dinner_water_amount, value: client.nutritions.find_by(date: Date.today).dinner_water_amount,  class:"water-default", id:"dinner-water" %> 
                <% end %>
              </td>
              <td class="one-column">
                <% if client.nutritions.find_by(date: Date.today).nil? %>
                  <%= f.number_field :twenty_water_amount, value: 0, class:"water-default", id:"twenty-water" %> 
                <% else %>
                  <%= f.number_field :twenty_water_amount, value: client.nutritions.find_by(date: Date.today).twenty_water_amount, class:"water-default", id:"twenty-water" %> 
                <% end %>
              </td>
                <%= f.hidden_field :client_id, value: client.id %>
              <td class="one-column">  
                <% if client.nutritions.where(date: Date.today).blank? %>
                  <%= f.submit "記録する" ,class:"submit-btn", id:"nutrition-submit" %>
                <% else %>
                  <%= f.submit "更新する" ,class:"submit-btn update", id:"nutrition-submit" %>
                <% end %>
              </td>
            <% end %>
          </tr>      
        <% end %>
      </table>
  </div>
</div>


<%= render "shared/footer"%>